# Handoff: 2026-02-07

## Summary

Codemm-IDE is now explicitly IDE-first and local-only:

- New mental model: **workspace → threads → runs**.
- Auth/accounts/community features removed from the engine and UI.
- “Sessions” are now treated as local **threads** (UI uses `/threads`; engine keeps `/sessions` only as a transitional alias).
- API keys are stored locally by Electron main (encrypted via `safeStorage`) and exposed to the UI via a minimal preload bridge.
- Engine persistence is now **workspace-scoped** via `CODEMM_DB_PATH=<workspaceDataDir>/codemm.db`.

## How To Run

From `Codemm-IDE/`:

```bash
npm install
npm run dev
```

- First launch prompts you to pick a workspace folder.
- Set your API key via the **API Key** screen in the UI.
  - Note (transitional): after changing the key, restart the IDE to apply it to the local engine process.

## Iteration Log

### Iteration 1 (Phase 1: Auth + Users + Community Removal)

- Engine (`apps/backend`)
  - Deleted auth/profile/community routes and related code paths.
  - Removed per-user API key storage in SQLite.
  - Added `/threads` endpoints and kept `/sessions` as a transitional alias.
  - Simplified persistence to local-only schema (no users table ownership logic).
- UI (`apps/frontend`)
  - Deleted auth/community/profile pages.
  - Updated chat UI to use threads (no tokens; history is local).
  - Updated activity/review flows to remove auth + community behavior.
  - Updated API key settings to use the Electron preload bridge (no HTTP).
- IDE wrapper (`apps/ide`)
  - Added `preload.js` bridge for workspace + secrets.
  - Added workspace selection and per-workspace DB path selection.
  - Injects locally stored API key into the engine process via env on boot.

### Iteration 2 (Phase 2 Started: IPC Engine Server)

- Added a local engine IPC entrypoint (`apps/backend/ipc-server.js`) and RPC handler (`apps/backend/src/ipcServer.ts`).
- Next: wire Electron main + preload APIs, migrate UI off `fetch()`/`EventSource`, then delete Express/SSE.

### Iteration 3 (Phase 2: UI → IPC, No Backend URL)

- IDE wrapper now boots the engine via Node IPC (`fork`) instead of HTTP health/ports (`apps/ide/main.js`).
- Preload exposes allowlisted local APIs: `threads`, `activities`, `judge`, plus a replayable generation event stream (`apps/ide/preload.js`).
- UI no longer calls `fetch()` / `EventSource` and no longer depends on `NEXT_PUBLIC_BACKEND_URL` (`apps/frontend/src/app/...`).

### Iteration 4 (Phase 2: Delete Express/SSE)

- Deleted Express server + route adapters from the engine (`apps/backend/src/server.ts`, `apps/backend/src/routes/*`).
- `codem-backend` now runs as an IPC engine (`apps/backend/ipc-server.js`), and `npm start`/`npm run dev` are updated accordingly.

### Iteration 5 (Docs: Phase 2 Cleanup)

- Updated repo docs to remove backend port/health/NEXT_PUBLIC_BACKEND_URL references and point contributors to the IPC surfaces.

### Iteration 6 (Docs: IDE_FIRST Runtime Topology)

- Updated `docs/architecture/IDE_FIRST.md` to reflect the current IPC-only runtime topology (no internal HTTP/Express/SSE).

### Iteration 7 (Phase 3 Started: Packaged Frontend Build)

- Frontend builds now produce a Next standalone bundle (`apps/frontend/next.config.ts`, `apps/frontend/scripts/prepare-standalone.mjs`).
- IDE can boot the standalone frontend server (packaged, or `CODEMM_FRONTEND_MODE=standalone` in dev) (`apps/ide/main.js`).
- Root scripts/config added for packaging (`electron-builder`) (`package.json`).

### Iteration 8 (Fix: Electron Boot Syntax Error)

- Fixed `SyntaxError: Identifier 'backendDbPath' has already been declared` by renaming the engine DB path variable in `apps/ide/main.js`.

## Known Gaps / Next

- API key changes require IDE restart (temporary; will become hot-reload or in-process).
