# Handoff: 2026-02-04

## Summary (Current State)

Codemm-IDE is now a monorepo that runs as a desktop Electron app and boots:

- `apps/backend` (Express + Docker judge) on `http://127.0.0.1:4000`
- `apps/frontend` (Next.js UI) on `http://127.0.0.1:3000`

## How To Run (Current)

From repo root:

```bash
npm install
npm run dev
```

## Iteration Log

### Iteration 1 (Initial Desktop Wrapper)

Commit(s): `edad00c`, `de04e1e`

- Electron wrapper booted backend + frontend and opened the existing UI in a desktop window.
- Added contributor docs + troubleshooting + functions.

### Iteration 2 (Maintainability + Security Docs)

Commit(s): `801ef07`

- Added `AGENTS.md` with repo rules (incremental commits, handoffs, Electron security defaults).
- Added `docs/SECURITY.md` and `docs/ARCHITECTURE.md`.

### Iteration 3 (Monorepo + Workspaces)

Commit(s): `270d048`, `29c83aa`, `92f4738`

- Imported `Codemm-backend` → `apps/backend` and `Codemm-frontend` → `apps/frontend` (git subtree).
- Moved IDE wrapper to `apps/ide`.
- Added npm workspaces + root scripts so one `npm install` works for everything.
- Updated Electron boot to:
  - install deps at repo root if needed
  - build judge Docker images from `apps/backend/Dockerfile.*-judge` as needed
  - start backend/frontend via workspaces
- Updated docs to match the monorepo layout.

### Iteration 4 (App Window Not Showing Fix)

Commit(s): `ae7084b`

- Fixed macOS Electron window lifecycle by keeping a global `BrowserWindow` reference.
- Added crash visibility via `uncaughtException`/`unhandledRejection` dialogs.
- Added `activate` handler so dock clicks re-show/re-create the window.

### Iteration 5 (Startup Logging / “Looks Hung” Debuggability)

Commit(s): `36fddb6`

- Added explicit `[ide]` logs for each startup phase (deps, judge images, backend, frontend).
- Made `docker build` use `--progress=plain` so image builds are not silent.
- Added periodic “Waiting for …” logs while polling backend/frontend readiness.

### Iteration 6 (Docker Check Timeout / Better Error)

Commit(s): `26b9109`

- Added a timeout to the Docker readiness check (`docker info`) so the IDE can't hang silently if Docker CLI stalls.
- Error dialog now includes the underlying `docker info` failure detail.

### Iteration 7 (Docker Wait/Retry Instead Of Immediate Fail)

Commit(s): (next)

- If `docker info` times out or fails while Docker Desktop is still starting, the IDE now retries for up to ~3 minutes with periodic logs instead of failing immediately.

## Known Gaps / Risks (Current)

- Still dev-mode:
  - backend uses `npm run dev`
  - frontend uses `next dev`
- Packaging into a distributable `.app` remains the next major milestone.
- Docker is required (expected) for judging; the IDE must never execute untrusted code outside Docker.

## Next Steps

1. Packaging:
   - add `electron-builder`
   - build backend + frontend in prod mode and run from inside the `.app`
   - rebuild native deps for Electron (notably `better-sqlite3`)
2. Electron hardening:
   - navigation allowlist (only local frontend URL)
   - block unexpected redirects and tighten external-link handling
