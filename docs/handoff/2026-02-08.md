# Handoff: 2026-02-08

## Summary

- Continued Phase 3 (packaging + determinism hardening).
- Threads persistence is now explicitly `threads*` in SQLite (legacy `sessions*` workspaces migrate in-place on startup).
- Generation progress is replayable from persisted `runs`/`run_events` (not just in-memory buffers).

## Iteration Log

### Iteration 1 (IPC Hardening + Packaged Engine)

- Electron main adds zod-based IPC payload validation for `threads/*`, `activities/*`, and secrets (`apps/ide/main.js`).
- Electron main adds zod-based IPC payload validation for `judge/*` (`apps/ide/main.js`).
- Packaged runs force the engine to load compiled `dist` (`CODEMM_ENGINE_USE_DIST=1`) (`apps/ide/main.js`, `apps/backend/ipc-server.js`).

### Iteration 2 (Troubleshooting)

- Documented native module ABI mismatch fixes (`better-sqlite3`) and SQLite schema-init recovery (`docs/TROUBLESHOOTING.md`).

### Iteration 3 (Packaging Determinism)

- `npm run dist:mac` now rebuilds native deps for Electron automatically (`npm run rebuild:electron`) to avoid `better-sqlite3` ABI issues in packaged runs (`package.json`).

## Known Gaps / Next

- API key changes still require restart (or a controlled engine restart + renderer resubscribe).
- Packaging still needs an end-to-end `.app` verification run on a machine with `electron-builder` available.
